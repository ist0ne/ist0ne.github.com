<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>石头记 | Docker、Kubernetes、CI/CD 等技术分享</title>

  
  <meta name="author" content="ist0ne">
  

  
  <meta name="description" content="Docker、Kubernetes、Ceph、Saltstack、OpenStack 等技术分享">
  

  
  <meta name="keywords" content="blog kubernetes k8s docker container ceph salt saltstack openstack kube kubectl helm charts gitlab git">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="石头记">

  
  <meta property="og:image" content="/favicon.ico">
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="石头记" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">石头记</a>
    </h1>
    <p class="site-description">Docker、Kubernetes、CI/CD 等技术分享</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/atom.xml">订阅</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2019/09/18/Kubernetes-1-0/"><span>Kubernetes 技术实践 -- 1.0 课程简介</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/09/18/Kubernetes-1-0/" rel="bookmark">
        <time class="entry-date published" datetime="2019-09-18T09:22:22.000Z">
          2019-09-18
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p></p>
<video id="video" controls preload="none" poster="/imgs/k8s.png">
      <source id="mp4" src="https://www.bilibili.com/video/av49387629/?p=21" type="video/mp4">
      <p>Your user agent does not support the HTML5 Video element.</p>
</video>

<p>为了让大家有更真实的体验，在这个培训课程中，我虚拟了一家互联网创业公司，而我们就是这家创业公司的技术人员，我们要从0开始为这家创业公司搭建IT环境，我们的所有服务都是容器化的，并运行在Kubernetes高可用集群上。我们的产品是由十一个微服务组成时尚购物网站，这十一个微服务由不同的语言写成，包括Java、Go、Python、Node.js和C#。我们通过CI/CD流水线驱动这些服务的开发迭代，并通过Istio进行服务治理，我们可以通过蓝绿部署、金丝雀部署、服务限流、熔断、链路追踪等技术来提升客户体验。我们为这家虚拟公司购买了域名（hipstershop.cn）和SSL证书，并完成了备案-_^，接下来，我们将一起完成这家公司的IT环境搭建。</p>
<h2 id="能学到什么？"><a href="#能学到什么？" class="headerlink" title="能学到什么？"></a>能学到什么？</h2><ul>
<li><strong>搭建生产环境可用的Kubernetes集群</strong> 我会从Kubernetes的架构开始讲起，然后给大家介绍Kubernetes的主要组件以及一些基本概念，带大家一起部署一个生产环境可用的Kubernetes集群，安装Kubernetes常用的插件，接下来为大家讲解在生成环境如何去升级已有的Kubernetes集群，最后为大家介绍如何轻松管理多个Kubernetes集群；</li>
<li><strong>Kubernetes编排基础</strong> 我会详细向大家讲解Pod基础与进阶，包括Pod的原理，API对象、Pod资源限制、Pod健康检查、生命周期管理、共享卷、Pod调度相关知识及生产环境建议及操作实践；Kubernetes常用资源对象，主要包括ReplicaSet、Deployment、StatefulSet、DeamonSet、Job等等；权限管理，包括ServiceAccount介绍、RBAC基于角色的访问控制等等；</li>
<li><strong>Kubernetes容器持久化存储</strong> 我会向大家你讲解容器卷、PV、PVC、StorageClass以及本地化持久存储相关的知识，最后会带大家实践如何使用Ceph分布式存储和阿里云云盘作为Kubernetes容器持久化存储；</li>
<li><strong>Kubernetes网络选型</strong> 我会向大家讲解容器跨主机网络、Kubernetes网络模型与CNI网络插件、常用的三层网络方案、以及Kubernetes服务发现，包括集群内部服务发现(Servcie)、集群外部服务访问(Ingress)、Headlss服务、CoreDNS以及4/7层服务发现实践；</li>
<li><strong>Kubernetes包管理工具Helm</strong> 我会向大家讲解如何搭建私有Helm仓库、如何使用Helm仓库、如何编写Helm Charts，并带领大家为我们网站的微服务编写charts，并上传等到私有Helm仓库；</li>
<li><strong>部署企业级私有仓库</strong> 我会带领大家一起部署企业级代码管理平台Gitlab和容器私有仓库Harbor，学完这部分内容你将掌握如何通过容器化的方式部署Gitlab和Harbor，以及Gitlab和Harbor的基本使用；</li>
<li><strong>CI/CD流水线</strong> 我会向大家讲解CI/CD流水线技术，并带大家认识几种CI/CD产品，介绍他们如何配置、使用，然后带大家使用CI/CD流水线将我们的网站部署到Kubernetes集群上，通过使用CI/CD流水线来提升我们的开发、测试、部署流程的自动化水平；</li>
<li><strong>Kubernetes日志管理</strong> 我会向大家讲解Kubernetes日志处理的基本原理，以及如何通过EFK收集Kubernetes集群的日志及微服务产生的日志；</li>
<li><strong>Kubernetes监控</strong> 我会向大家讲解Kubernetes监控原理，如何部署Prometheus，并使用它进行集群及应用监控，结合AlertManager实现故障告警；</li>
<li><strong>通过Istio实现服务治理</strong> 我会向大家讲解Istio是什么，他能做什么，以及如何使用Istio实现微服务服务的蓝绿部署、金丝雀部署，如何对服务进行限流、熔断和链路追踪。</li>
</ul>
<h2 id="学员收获"><a href="#学员收获" class="headerlink" title="学员收获"></a>学员收获</h2><ul>
<li>从0-1全系统化学习Kubernetes，对调度系统、网络、存储、日志监控、CI/CD、服务治理等有全局了解，熟悉学习路线</li>
<li>提高Kubernetes技术在企业落地效率，生产实践路上少走弯路</li>
<li>熟悉Kubernetes生产最佳实践，避免踩坑</li>
<li>专属QQ交流群，有任何问题老师会在群里给大家答疑</li>
<li>代码开放，课程案例代码完全开发给你，你可以根据所学知识自行修改、优化</li>
</ul>
<h2 id="适合人群"><a href="#适合人群" class="headerlink" title="适合人群"></a>适合人群</h2><ul>
<li>容器基础薄弱，但对容器生态技术有浓厚兴趣的小伙伴</li>
<li>已经将容器用于生产环境，但是希望获得最佳实践，避免少走弯路的小伙伴</li>
<li>对容器技术有一定了解和接触，期望系统化的深入理解的小伙伴</li>
<li>容器技术爱好者、云计算从业者、运维工程师、容器项目开发工程师、架构师</li>
</ul>
<h2 id="技术储备要求"><a href="#技术储备要求" class="headerlink" title="技术储备要求"></a>技术储备要求</h2><ul>
<li>熟悉基本Linux操作，对CentOS、Ubuntu等系统有一定的了解。熟悉Linux基本命令行操作，熟悉软件包安装、升级方法，有基本的排查能力。</li>
<li>熟悉Docker容器概念与原理，如果对容器基础概念不熟悉建议先学习：<a href="https://github.com/findsec-cn/docker课程" target="_blank" rel="noopener">https://github.com/findsec-cn/docker课程</a></li>
<li>熟悉YAML语法，如果不是熟悉建议参考学习：<a href="http://www.ruanyifeng.com/blog/2016/07/yaml.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2016/07/yaml.html</a></li>
</ul>
<h2 id="课程优势"><a href="#课程优势" class="headerlink" title="课程优势"></a>课程优势</h2><ul>
<li>系统化：网上很多课程只讲某些章节，例如，安装、监控、某几个组件；缺少系统化学习，很难对各个模块相互之间联系进行深入了解。</li>
<li>生产化：老师不仅仅分享实操、理论，更重要是分享在生产环境实践经验，以及运维过程中踩过的一些坑。</li>
<li>新版本：我们选择了Kubernetes的新版本（1.14.x-1.15.x）为大家讲解。如果有新版本发布，我们还会向大家讲解如何进行Kubernetes版本升级。</li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/docker/">docker</a><a href="/tags/container/">container</a><a href="/tags/kubernetes/">kubernetes</a><a href="/tags/k8s/">k8s</a><a href="/tags/helm/">helm</a><a href="/tags/kubectl/">kubectl</a><a href="/tags/dashboard/">dashboard</a><a href="/tags/traefik/">traefik</a>
    </span>
    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2019/09/18/Kubernetes-1-0/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2019/07/20/gitlab-install/"><span>Gitlab部署和基本使用</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/07/20/gitlab-install/" rel="bookmark">
        <time class="entry-date published" datetime="2019-07-20T02:50:32.000Z">
          2019-07-20
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="关于版本控制系统"><a href="#关于版本控制系统" class="headerlink" title="关于版本控制系统"></a>关于版本控制系统</h2><p>版本控制是一种记录一个或若干文件内容变化，以便将来查阅特定版本修订情况的系统。在软件开发过程中，为了更好的管理软件的多个开发版本我们通常需要使用版本控制系统。常用的版本控制系统有：svn和git。</p>
<p>svn是集中化的版本控制系统, 只有一个单一的集中管理的服务器，保存所有文件的修订版本，而协同工作的人们都通过客户端连到这台服务器，取出最新的文件或者提交更新。</p>
<p><img src="/imgs/201907/gitlab_svn.png" alt="SVN"></p>
<p>git是分布式的版本控制系统, 每一个终端都是一个仓库，客户端并不只提取最新版本的文件快照，而是把原始的代码仓库完整地镜像下来。每一次的提取操作，实际上都是一次对代码仓库的完整备份。</p>
<p><img src="/imgs/201907/gitlab_git.png" alt="git"></p>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/docker/">docker</a><a href="/tags/container/">container</a><a href="/tags/kubernetes/">kubernetes</a><a href="/tags/k8s/">k8s</a><a href="/tags/gitlab/">gitlab</a><a href="/tags/git/">git</a>
    </span>
    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2019/07/20/gitlab-install/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2019/07/19/harbor-install/"><span>私有镜像仓库Harbor部署、使用</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/07/19/harbor-install/" rel="bookmark">
        <time class="entry-date published" datetime="2019-07-19T02:28:31.000Z">
          2019-07-19
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="Harbor介绍"><a href="#Harbor介绍" class="headerlink" title="Harbor介绍"></a>Harbor介绍</h2><p>Harbor是VMware公司开源的企业级Docker Registry项目，其目标是帮助用户迅速搭建一个企业级的Docker私有镜像仓库。Harbor基于官方Registry V2实现，提供了管理UI，基于角色的访问控制，LDAP集成、镜像复制、以及审计日志等企业用户需求的功能。</p>
<ul>
<li><strong>图形化用户界面</strong> 用户可以通过浏览器来浏览、检索Docker镜像仓库，管理项目。</li>
<li><strong>基于角色的访问控制</strong> 按项目对Docker镜像进行组织，可以按项目对用户授权。</li>
<li><strong>镜像复制</strong> 镜像可以在多个Harbor实例之间复制。镜像复制可以很好的应对多云、多数据中心的场景。</li>
<li><strong>LDAP支持</strong> Harbor可以集成企业内部AD/LDAP，方便统一进行用户管理。</li>
<li><strong>审计管理</strong> 所有针对镜像仓库的操作都可以被记录追溯，用于审计管理。</li>
</ul>
<p>另外，Harbor也可以对上传的镜像进行漏洞扫描和签名，新版的Harbor也加入Helm仓库的功能。</p>
<p><img src="/imgs/201907/harbor.png" alt="Harbor"></p>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/docker/">docker</a><a href="/tags/container/">container</a><a href="/tags/kubernetes/">kubernetes</a><a href="/tags/k8s/">k8s</a><a href="/tags/harbor/">harbor</a>
    </span>
    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2019/07/19/harbor-install/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2019/07/03/Use-Terraform-In-AliCloud/"><span>使用Terraform在阿里云创建Kubernetes集群资源</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/07/03/Use-Terraform-In-AliCloud/" rel="bookmark">
        <time class="entry-date published" datetime="2019-07-03T05:59:51.000Z">
          2019-07-03
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>HashiCorp Terraform 是一个IT基础架构自动化编排工具，可以用代码来高效地预配和管理云基础架构。Terraform的命令行接口(CLI)提供一种简单机制，用于将配置文件部署到阿里云或其他任意支持的云上，并对其进行版本控制。</p>
<p>Terraform是一个高度可扩展的工具，通过Provider来支持新的基础架构。您可以使用Terraform来创建、修改、删除ECS、VPC、RDS、SLB等多种资源。</p>
<h2 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h2><ul>
<li><p><strong>将基础结构部署到多个云</strong> - Terraform适用于多云方案，将相类似的基础结构部署到阿里云、其他云提供商或者本地数据中心。开发人员能够使用相同的工具和相似的配置文件同时管理不同云提供商的资源。</p>
</li>
<li><p><strong>自动化管理基础结构</strong> - Terraform能够创建配置文件的模板，以可重复、可预测的方式定义、预配和配置ECS资源，减少因人为因素导致的部署和管理错误。能够多次部署同一模板，创建相同的开发、测试和生产环境。</p>
</li>
<li><p><strong>基础架构即代码（Infrastructure as Code）</strong> - 可以用代码来管理维护资源。允许保存基础设施状态，从而使您能够跟踪对系统（基础设施即代码）中不同组件所做的更改，并与其他人共享这些配置 。</p>
</li>
</ul>
<h2 id="安装和配置Terraform"><a href="#安装和配置Terraform" class="headerlink" title="安装和配置Terraform"></a>安装和配置Terraform</h2><p>1、前往<a href="https://www.terraform.io/downloads.html" target="_blank" rel="noopener">Terraform官网</a>下载适用于您的操作系统的程序包。</p>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/docker/">docker</a><a href="/tags/container/">container</a><a href="/tags/kubernetes/">kubernetes</a><a href="/tags/k8s/">k8s</a><a href="/tags/terraform/">terraform</a>
    </span>
    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2019/07/03/Use-Terraform-In-AliCloud/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2019/07/03/Kubernetes-Ingress-with-Cert-Manager/"><span>在Kubernetes Ingress中使用Cert-Manager管理TLS证书</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/07/03/Kubernetes-Ingress-with-Cert-Manager/" rel="bookmark">
        <time class="entry-date published" datetime="2019-07-03T05:32:06.000Z">
          2019-07-03
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>Kubernetes Ingresses 允许你灵活的将外部流量路由到集群内部。我们通过Ingress资源定义规则路由HTTP和HTTPS流量到Kubernetes Services。本文中我们通过cert-manager来管理TLS证书以加密HTTP流量。</p>
<h2 id="部署后端服务"><a href="#部署后端服务" class="headerlink" title="部署后端服务"></a>部署后端服务</h2><p>首先我们需要一个事例服务，部署配置文件(echo.yaml)如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">echo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">ports:</span></span><br><span class="line"><span class="attr">- port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">5678</span></span><br><span class="line"><span class="attr">selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">echo</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">echo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">echo</span></span><br><span class="line"><span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">    labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">echo</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">    containers:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">echo1</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">hashicorp/http-echo</span></span><br><span class="line"><span class="attr">        args:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">"-text=echo"</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="attr">        - containerPort:</span> <span class="number">5678</span></span><br></pre></td></tr></table></figure>

<p>在这个配置文件中我们定义了一个服务叫做<code>echo</code>，它会将来自于80端口的TCP流量路由到标签为<code>app: echo</code>的Pods中的5678端口上。<br>我们定义了名为<code>echo</code>的Deployment，它用来管理打了<code>app: echo</code>标签的Pods。我们在Deployment中定义Pod的副本数为2，Pod启动的容器名为<code>echo</code>，使用的镜像为<code>hashicorp/http-echo</code>，我们给<code>echo</code>传递了<code>text</code>参数，值为<code>echo</code>，意思是我们在访问这个服务时，他向我们返回<code>echo</code>字符串。最后，我们打开了5678端口来监听用户请求。</p>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/docker/">docker</a><a href="/tags/container/">container</a><a href="/tags/kubernetes/">kubernetes</a><a href="/tags/k8s/">k8s</a><a href="/tags/helm/">helm</a><a href="/tags/kubectl/">kubectl</a><a href="/tags/ingress/">ingress</a><a href="/tags/cert-manager/">cert-manager</a>
    </span>
    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2019/07/03/Kubernetes-Ingress-with-Cert-Manager/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2019/07/02/Kubernetes-Addons/"><span>Kubernetes 常用组件安装</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/07/02/Kubernetes-Addons/" rel="bookmark">
        <time class="entry-date published" datetime="2019-07-02T02:08:31.000Z">
          2019-07-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <blockquote>
<p><strong>视频课程地址：</strong><a href="https://www.bilibili.com/video/av49387629?from=search&seid=4418298671230182069" target="_blank" rel="noopener">戳我开始学习</a></p>
</blockquote>
<h2 id="创建集群管理员账户（Cluster-Admin）"><a href="#创建集群管理员账户（Cluster-Admin）" class="headerlink" title="创建集群管理员账户（Cluster Admin）"></a>创建集群管理员账户（Cluster Admin）</h2><p>编写配置文件 admin-role.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">admin</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="string">rbac.authorization.kubernetes.io/autoupdate:</span> <span class="string">"true"</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line"><span class="attr">  kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">cluster-admin</span></span><br><span class="line"><span class="attr">  apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="attr">- kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">admin</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">admin</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line">    <span class="string">kubernetes.io/cluster-service:</span> <span class="string">"true"</span></span><br><span class="line">    <span class="string">addonmanager.kubernetes.io/mode:</span> <span class="string">Reconcile</span></span><br></pre></td></tr></table></figure>

<p>执行命令创建账户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create -f admin-role.yaml</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/admin created</span><br><span class="line">serviceaccount/admin created</span><br></pre></td></tr></table></figure>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/docker/">docker</a><a href="/tags/container/">container</a><a href="/tags/kubernetes/">kubernetes</a><a href="/tags/k8s/">k8s</a><a href="/tags/helm/">helm</a><a href="/tags/kubectl/">kubectl</a><a href="/tags/dashboard/">dashboard</a><a href="/tags/traefik/">traefik</a>
    </span>
    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2019/07/02/Kubernetes-Addons/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2019/07/01/Kubernetes-Update/"><span>Kubernetes 集群升级</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/07/01/Kubernetes-Update/" rel="bookmark">
        <time class="entry-date published" datetime="2019-07-01T08:56:49.000Z">
          2019-07-01
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <blockquote>
<p><strong>视频课程地址：</strong><a href="https://www.bilibili.com/video/av49387629?from=search&seid=4418298671230182069" target="_blank" rel="noopener">戳我开始学习</a></p>
</blockquote>
<h2 id="控制平面升级"><a href="#控制平面升级" class="headerlink" title="控制平面升级"></a>控制平面升级</h2><p>只有master节点需要执行如下操作，需要逐节点操作。将集群从当前的v1.14.3升级到v1.15.0。</p>
<p>列出可用的kubeadm软件包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum list --showduplicates kubeadm --disableexcludes=kubernetes</span><br></pre></td></tr></table></figure>

<p>安装kubeadm新版本软件包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y kubeadm-1.15.0-0 --disableexcludes=kubernetes</span><br></pre></td></tr></table></figure>

<p>确认kubeadm为正确的版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubeadm version</span><br></pre></td></tr></table></figure>

<p>查看升级计划</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubeadm upgrade plan</span><br></pre></td></tr></table></figure>

<p>升级第一个控制节点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubeadm upgrade apply v1.15.0</span><br></pre></td></tr></table></figure>

<p>升级kubelet软件包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y kubelet-1.15.0-0 kubectl-1.15.0-0 --disableexcludes=kubernetes</span><br></pre></td></tr></table></figure>

<p>重启kubelet服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl restart kubelet</span><br></pre></td></tr></table></figure>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/docker/">docker</a><a href="/tags/container/">container</a><a href="/tags/kubernetes/">kubernetes</a><a href="/tags/k8s/">k8s</a><a href="/tags/kubectl/">kubectl</a><a href="/tags/kubeadm/">kubeadm</a>
    </span>
    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2019/07/01/Kubernetes-Update/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2019/06/30/Kubernetes-Install/"><span>高可用 Kubernetes 集群部署</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/06/30/Kubernetes-Install/" rel="bookmark">
        <time class="entry-date published" datetime="2019-06-30T04:09:18.000Z">
          2019-06-30
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <blockquote>
<p><strong>视频课程地址：</strong><a href="https://www.bilibili.com/video/av49387629?from=search&seid=4418298671230182069" target="_blank" rel="noopener">戳我开始学习</a></p>
</blockquote>
<h2 id="Kubernetes版本选择"><a href="#Kubernetes版本选择" class="headerlink" title="Kubernetes版本选择"></a>Kubernetes版本选择</h2><p>Kubernetes 1.14是2019年发布的第一个正式版本。新版本有31个增强功能：其中有10个功能进入了生产可用状态，12个进入了beta版本，另外，增加了7个新功能。1.14版本的主题是可扩展性，支持更多Kubernetes工作负载，其中三个主要功能正式推出，以及一个重要的安全功能转向beta。与之前发布的Kubernetes版本相比，1.14版本中的更多功能逐渐稳定，这是大家期望的重要里程碑。</p>
<ul>
<li><strong>生产级别的Windwos节点支持</strong> Kubernetes1.14版本正式支持将Windows节点添加为工作节点，这意味着可以在生产环境使用Windows容器了，使庞大的Windows应用生态系统能够利用Kubernetes平台的强大功能了。</li>
<li><strong>Kubectl的更新</strong> 新版本Kubectl可以使用声明性Resource Config来管理资源。kubectl的文档也从头进行编写，可参考<a href="https://kubectl.docs.kubernetes.io" target="_blank" rel="noopener">文档</a>。</li>
<li><strong>持久化本地Volumes</strong> 本地SSD比远程磁盘能提供更好的性能。对性能要求比较高的数据库和分布式文件系统可以使用久化本地存储。
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/docker/">docker</a><a href="/tags/container/">container</a><a href="/tags/kubernetes/">kubernetes</a><a href="/tags/k8s/">k8s</a><a href="/tags/helm/">helm</a><a href="/tags/kubectl/">kubectl</a><a href="/tags/kubeadm/">kubeadm</a>
    </span>
    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2019/06/30/Kubernetes-Install/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/09/11/Docker-Compose-PHP-ENV/"><span>Docker Compose 搭建 PHP 开发环境</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/09/11/Docker-Compose-PHP-ENV/" rel="bookmark">
        <time class="entry-date published" datetime="2018-09-11T06:32:23.000Z">
          2018-09-11
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>Docker PHP 可以快速构建基于 Docker 的 PHP 本地开发环境，此套 LNMP 环境同时支持 PHP 5 和 PHP 7。请克隆此项目使用：<a href="https://github.com/ist0ne/docker-php.git" target="_blank" rel="noopener">https://github.com/ist0ne/docker-php.git</a></p>
<h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><p>PHP/FPM 7.2/5.6、Nginx 1.12、Mysql 5.7、Redis 4.0、Memcached 1.5</p>
<h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">├── add_project.sh  新建项目脚本（Linux）</span><br><span class="line">├── build  镜像构建目录</span><br><span class="line">│   ├── memcached</span><br><span class="line">│   │   └── Dockerfile</span><br><span class="line">│   ├── mysql</span><br><span class="line">│   │   └── Dockerfile</span><br><span class="line">│   ├── nginx</span><br><span class="line">│   │   └── Dockerfile</span><br><span class="line">│   ├── php5</span><br><span class="line">│   │   └── Dockerfile</span><br><span class="line">│   ├── php7</span><br><span class="line">│   │   └── Dockerfile</span><br><span class="line">│   └── redis</span><br><span class="line">│       └── Dockerfile</span><br><span class="line">├── config  服务配置目录</span><br><span class="line">│   ├── mysql</span><br><span class="line">│   │   ├── backup</span><br><span class="line">│   │   ├── config</span><br><span class="line">│   │   │   └── mysql.cnf</span><br><span class="line">│   │   ├── crontabs</span><br><span class="line">│   │   └── docker-entrypoint-initdb.d  数据库初始化脚本目录</span><br><span class="line">│   ├── nginx</span><br><span class="line">│   │   ├── conf.d</span><br><span class="line">│   │   │   ├── bar.example.com.conf</span><br><span class="line">│   │   │   ├── foo.example.com.conf</span><br><span class="line">│   │   │   └── example.com.conf.template</span><br><span class="line">│   │   ├── fastcgi_mysql</span><br><span class="line">│   │   ├── fastcgi_web</span><br><span class="line">│   │   └── nginx.conf</span><br><span class="line">│   ├── php5</span><br><span class="line">│   │   ├── php.ini</span><br><span class="line">│   │   └── php.ini-production</span><br><span class="line">│   ├── php7</span><br><span class="line">│   │   ├── php.ini</span><br><span class="line">│   │   └── php.ini-production</span><br><span class="line">│   └── redis</span><br><span class="line">│       └── redis.conf</span><br><span class="line">├── data 服务数据目录</span><br><span class="line">│   ├── mysql  数据库数据存储目录</span><br><span class="line">│   ├── nginx</span><br><span class="line">│   │   ├── cache  应用缓存目录</span><br><span class="line">│   │   └── data  应用数据目录</span><br><span class="line">│   └── redis  缓存数据目录</span><br><span class="line">├── docker-compose.yml  项目配置文件</span><br><span class="line">├── logs 服务日志目录</span><br><span class="line">│   ├── access  Nginx访问日志目录</span><br><span class="line">│   │   ├── bar.example.com</span><br><span class="line">│   │   │   └── bar.example.com.log</span><br><span class="line">│   │   └── foo.example.com</span><br><span class="line">│   │       └── foo.example.com.log</span><br><span class="line">│   ├── app  应用日志目录</span><br><span class="line">│   │   ├── bar.example.com</span><br><span class="line">│   │   └── foo.example.com</span><br><span class="line">│   └── srv  服务日志目录</span><br><span class="line">│       ├── memcached</span><br><span class="line">│       ├── mysql</span><br><span class="line">│       │   └── error.log</span><br><span class="line">│       ├── nginx</span><br><span class="line">│       │   └── nginx_error.log</span><br><span class="line">│       ├── php5</span><br><span class="line">│       │   └── php_errors.log</span><br><span class="line">│       ├── php7</span><br><span class="line">│       │   └── php_errors.log</span><br><span class="line">│       └── redis</span><br><span class="line">│           └── redis.log</span><br><span class="line">├── README.md</span><br><span class="line">└── webapps  应用代码目录</span><br><span class="line">    ├── bar.example.com</span><br><span class="line">    │   └── htdocs</span><br><span class="line">    │       └── index.php</span><br><span class="line">    └── foo.example.com</span><br><span class="line">        └── htdocs</span><br><span class="line">            └── index.php</span><br></pre></td></tr></table></figure>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/docker/">docker</a><a href="/tags/container/">container</a><a href="/tags/compose/">compose</a><a href="/tags/develop/">develop</a><a href="/tags/php/">php</a>
    </span>
    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2018/09/11/Docker-Compose-PHP-ENV/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/09/10/Docker-Compose/"><span>Docker Compose</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/09/10/Docker-Compose/" rel="bookmark">
        <time class="entry-date published" datetime="2018-09-10T08:24:51.000Z">
          2018-09-10
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Compose 项目是 Docker 官方的开源项目，负责实现对 Docker 容器集群的快速编排。Compose 定位是 「定义和运行多个 Docker 容器化应用（Defining and running multi-container Docker applications）」，其前身是开源项目 Fig。</p>
<p>在日常工作中，经常会碰到需要多个容器相互配合来完成某项任务的情况。例如要实现一个 Web 项目，除了 Web 服务容器本身，往往还需要再加上缓存服务容器，已经后端的数据库服务容器。Compose 恰好满足了这样的需求。它允许用户通过一个单独的 docker-compose.yml 模板文件（YAML 格式）来定义一组相关联的应用容器为一个项目（project）。</p>
<p>Compose 中有两个重要的概念：</p>
<ul>
<li>服务 (service)：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。</li>
<li>项目 (project)：由一组关联的应用容器组成的一个完整业务单元，在 docker-compose.yml 文件中定义。
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/docker/">docker</a><a href="/tags/container/">container</a><a href="/tags/compose/">compose</a>
    </span>
    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2018/09/10/Docker-Compose/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>




<nav class="pagination">
  
  
  <a href="/page/2/" class="pagination-next">下一页</a>
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2019 ist0ne
    
  </p>
</footer>
    
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-39923501-1', 'auto');
    ga('send', 'pageview');

</script>

  </div>
</div>
</body>
</html>