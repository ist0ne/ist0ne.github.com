<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Openstack 使用 | 石头记 | Docker、Kubernetes、CI/CD 等技术分享</title>

  
  <meta name="author" content="ist0ne">
  

  
  <meta name="description" content="Openstack 使用">
  

  
  <meta name="keywords" content="blog kubernetes k8s docker container ceph salt saltstack openstack kube kubectl helm charts gitlab git">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="Openstack 使用">

  <meta property="og:site_name" content="石头记">

  
  <meta property="og:image" content="/favicon.ico">
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="石头记" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">石头记</a>
    </h1>
    <p class="site-description">Docker、Kubernetes、CI/CD 等技术分享</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/atom.xml">订阅</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>Openstack 使用</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2014/09/10/openstack-use/" rel="bookmark">
        <time class="entry-date published" datetime="2014-09-10T03:00:00.000Z">
          2014-09-10
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>OpenStack作为基础设施即服务（简称IaaS）资源的通用前端。首要任务是简化云的部署过程并为其带来良好的可扩展性。本文希望通过提供必要的指导信息，帮助大家利用OpenStack前端来设置及管理自己的私有云。</p>
<h2 id="导入虚拟机镜像"><a href="#导入虚拟机镜像" class="headerlink" title="导入虚拟机镜像"></a>导入虚拟机镜像</h2><p>如下列出了一下虚拟机镜像，可以在本地下载后通过Openstack界面导入。</p>
<p><a href="https://openstack.redhat.com/Image_resources" target="_blank" rel="noopener">https://openstack.redhat.com/Image_resources</a></p>
<p>也可以参考如下文档自己制作镜像：</p>
<p><a href="https://www.ibm.com/developerworks/community/wikis/home?lang=en#!/wiki/OpenStack/page/Creating%20qcow2%20CentOS%20Image%20for%20OpenStack" target="_blank" rel="noopener">https://www.ibm.com/developerworks/community/wikis/home?lang=en#!/wiki/OpenStack/page/Creating%20qcow2%20CentOS%20Image%20for%20OpenStack</a></p>
<p>导入镜像：</p>
<p>点击左侧的镜像 选项卡，可以看到已经导入的镜像，点击创建镜像 按钮创建镜像。</p>
<p><img src="/images/14-09-10/openstack_images.png" alt="Openstack镜像"></p>
<p>填写 镜像名称，镜像源选择—镜像文件，格式选择 QCOW2，勾选 公有 框（这样你上传得镜像其他人也能使用），然后点击创建镜像。</p>
<p><img src="/images/14-09-10/openstack_create_image.png" alt="Openstack创建镜像"></p>
<h2 id="创建虚拟机"><a href="#创建虚拟机" class="headerlink" title="创建虚拟机"></a>创建虚拟机</h2><p>点击左侧的 实例 选项卡，可以看到已创建的虚拟机，点击右上角的启动云主机创建 虚拟机。</p>
<p><img src="/images/14-09-10/openstack_create_vm_1.png" alt="Openstack创建虚拟机1"></p>
<p>在详情选项卡填写云主机名称、选择云主机的规格类型、云主机数量、云主机启动的源，本文从镜像启动，然后选择镜像名称，点击 访问 &amp; 安全选项卡。</p>
<p><img src="/images/14-09-10/openstack_create_vm_2.png" alt="Openstack创建虚拟机2"></p>
<p>选择一个秘钥对，如果没有需要点击加按钮进行创建，此秘钥对用于登陆创建的虚拟主机（在Openstack中虚拟主机的登陆一般不是通过用户名密码登陆的）。安全组选择default（用于设置防火墙规则）。</p>
<p><img src="/images/14-09-10/openstack_create_vm_3.png" alt="Openstack创建虚拟机3"></p>
<p>如下创建秘钥对：</p>
<p><img src="/images/14-09-10/openstack_create_vm_4.png" alt="Openstack创建虚拟机4"></p>
<p>点击 网络 选项卡，点击网络框中的+为虚拟机选择私有网络。</p>
<p><img src="/images/14-09-10/openstack_create_vm_5.png" alt="Openstack创建虚拟机5"></p>
<p>以上设置完成后点击运行，开始创建虚拟机。</p>
<p><img src="/images/14-09-10/openstack_create_vm_6.png" alt="Openstack创建虚拟机6"></p>
<p>点击更多，分配浮动IP地址，虚拟机只能通过浮动IP地址进行登陆。</p>
<p><img src="/images/14-09-10/openstack_create_vm_7.png" alt="Openstack创建虚拟机7"></p>
<h2 id="访问-amp-安全"><a href="#访问-amp-安全" class="headerlink" title="访问 &amp; 安全"></a>访问 &amp; 安全</h2><p>默认情况下，创建的虚拟机不能被ping 通和进行ssh 连接，需要修改默认安全规则。点击 管理规则。</p>
<p><img src="/images/14-09-10/openstack_access_1.png" alt="Openstack访问 &amp; 安全1"></p>
<p>然后点击添加规则。</p>
<p><img src="/images/14-09-10/openstack_access_2.png" alt="Openstack访问 &amp; 安全2"></p>
<p>如下添加ICMP规则，允许虚拟机被ping通。</p>
<p><img src="/images/14-09-10/openstack_access_3_icmp.png" alt="Openstack访问 &amp; 安全3"></p>
<p>添加SSH规则，允许虚拟机通过SSH客户端进行连接。</p>
<p><img src="/images/14-09-10/openstack_access_4_ssh.png" alt="Openstack访问 &amp; 安全4"></p>
<p>分配完浮动IP地址并设置好安全规则就可以登陆虚拟机了（必须在生成ssh key的机器上进行登陆）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@fuel ~]<span class="comment"># ssh centos@172.16.200.133</span></span><br><span class="line">[centos@vm-centos-7 ~]$ sudo su -</span><br><span class="line">[root@vm-centos-7 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h2 id="为虚拟机挂载数据盘"><a href="#为虚拟机挂载数据盘" class="headerlink" title="为虚拟机挂载数据盘"></a>为虚拟机挂载数据盘</h2><p>点击 左侧的 云硬盘 选项卡，点击 创建云硬盘 按钮，然后如下填写 创建云硬盘。</p>
<p><img src="/images/14-09-10/openstack_vdisk_1.png" alt="Openstack云硬盘1"></p>
<p>然后点击更多，选择 编辑挂载。</p>
<p><img src="/images/14-09-10/openstack_vdisk_2.png" alt="Openstack云硬盘2"></p>
<p>选择要连接到的虚拟机，然后连接数据盘。</p>
<p><img src="/images/14-09-10/openstack_vdisk_3.png" alt="Openstack云硬盘3"></p>
<p>登陆虚拟机，对已挂在的数据盘进行分区。</p>
<p><img src="/images/14-09-10/openstack_vdisk_4.png" alt="Openstack云硬盘4"></p>
<p><img src="/images/14-09-10/openstack_vdisk_5.png" alt="Openstack云硬盘5"></p>
<p>格式化数据盘并挂载。</p>
<p><img src="/images/14-09-10/openstack_vdisk_6.png" alt="Openstack云硬盘6"></p>
<p>将需要挂载的数据盘 写入/etc/fstab文件，以便开机自动挂载。</p>
<p><img src="/images/14-09-10/openstack_vdisk_7.png" alt="Openstack云硬盘7"></p>
<h2 id="为admin租户新增网段"><a href="#为admin租户新增网段" class="headerlink" title="为admin租户新增网段"></a>为admin租户新增网段</h2><p># 设置认证信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># cat creds-admin</span></span><br><span class="line"><span class="built_in">export</span> OS_TENANT_NAME=admin</span><br><span class="line"><span class="built_in">export</span> OS_USERNAME=admin</span><br><span class="line"><span class="built_in">export</span> OS_PASSWORD=admin</span><br><span class="line"><span class="built_in">export</span> OS_AUTH_URL=<span class="string">"http://172.16.200.2:5000/v2.0/“</span></span><br></pre></td></tr></table></figure>
<p># 使认证信息生效</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># . creds-admin</span></span><br></pre></td></tr></table></figure>
<p># 列出所有租户信息，admin的租户ID为：f51b22163f504dd6a6014f4700e9ee48</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># keystone tenant-list</span></span><br><span class="line">+----------------------------------+----------+---------+</span><br><span class="line">|                id                |   name   | enabled |</span><br><span class="line">+----------------------------------+----------+---------+</span><br><span class="line">| f51b22163f504dd6a6014f4700e9ee48 |  admin   |   True  |</span><br><span class="line">| 8dc964cb23414e1497a74db79ddb563f | services |   True  |</span><br><span class="line">+----------------------------------+----------+---------+</span><br></pre></td></tr></table></figure>
<p># 为admin租户添加网络net_admin，net_admin网络ID为：284d3f00-042b-41b2-bec4-f5bc7dcee037</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># neutron net-create --tenant-id f51b22163f504dd6a6014f4700e9ee48 net_admin</span></span><br><span class="line">Created a new network:</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| Field                     | Value                                |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| admin_state_up            | True                                 |</span><br><span class="line">| id                        | 284d3f00-042b-41b2-bec4-f5bc7dcee037 |</span><br><span class="line">| name                      | net_admin                            |</span><br><span class="line">| provider:network_type     | vlan                                 |</span><br><span class="line">| provider:physical_network | physnet2                             |</span><br><span class="line">| provider:segmentation_id  | 511                                  |</span><br><span class="line">| shared                    | False                                |</span><br><span class="line">| status                    | ACTIVE                               |</span><br><span class="line">| subnets                   |                                      |</span><br><span class="line">| tenant_id                 | f51b22163f504dd6a6014f4700e9ee48     |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>
<p># 为net_admin网络添加子网，子网ID：31896641-28e4-4983-b24d-f37348286a85</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># neutron subnet-create --name net_admin__subnet --tenant-id f51b22163f504dd6a6014f4700e9ee48 net_admin 192.168.101.0/24</span></span><br><span class="line">Created a new subnet:</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">| Field            | Value                                                |</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">| allocation_pools | &#123;<span class="string">"start"</span>: <span class="string">"192.168.101.2"</span>, <span class="string">"end"</span>: <span class="string">"192.168.101.254"</span>&#125; |</span><br><span class="line">| cidr             | 192.168.101.0/24                                     |</span><br><span class="line">| dns_nameservers  |                                                      |</span><br><span class="line">| enable_dhcp      | True                                                 |</span><br><span class="line">| gateway_ip       | 192.168.101.1                                        |</span><br><span class="line">| host_routes      |                                                      |</span><br><span class="line">| id               | 31896641-28e4-4983-b24d-f37348286a85                 |</span><br><span class="line">| ip_version       | 4                                                    |</span><br><span class="line">| name             | net_admin__subnet                                    |</span><br><span class="line">| network_id       | 284d3f00-042b-41b2-bec4-f5bc7dcee037                 |</span><br><span class="line">| tenant_id        | f51b22163f504dd6a6014f4700e9ee48                     |</span><br><span class="line">+------------------+------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<p># 修改子网dns地址</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># neutron subnet-update 31896641-28e4-4983-b24d-f37348286a85 --dns_nameservers list=true 8.8.4.4 8.8.8.8</span></span><br><span class="line">Updated subnet: 31896641-28e4-4983-b24d-f37348286a85</span><br></pre></td></tr></table></figure>
<p># 列出路由器信息，路由器ID为：dfcf3d90-2409-4505-a020-58b8ed3c9e67</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># neutron router-list</span></span><br><span class="line">+--------------------------------------+----------+-----------------------------------------------------------------------------+</span><br><span class="line">| id                                   | name     | external_gateway_info                                                       |</span><br><span class="line">+--------------------------------------+----------+-----------------------------------------------------------------------------+</span><br><span class="line">| dfcf3d90-2409-4505-a020-58b8ed3c9e67 | router04 | &#123;<span class="string">"network_id"</span>: <span class="string">"c4448c0d-f633-449a-861a-a39a304cad21"</span>, <span class="string">"enable_snat"</span>: <span class="literal">true</span>&#125; |</span><br><span class="line">+--------------------------------------+----------+-----------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<p># 将子网（31896641-28e4-4983-b24d-f37348286a85）连接到路由器（dfcf3d90-2409-4505-a020-58b8ed3c9e67）上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># neutron router-interface-add dfcf3d90-2409-4505-a020-58b8ed3c9e67 31896641-28e4-4983-b24d-f37348286a85</span></span><br><span class="line">Added interface a8e6c89f-45a4-4b20-876c-844e46f09a46 to router dfcf3d90-2409-4505-a020-58b8ed3c9e67.</span><br></pre></td></tr></table></figure>
<p># 列出代理信息，DHCP代理ID为：75a25941-0b13-4efc-aea8-ad7150d3e89e</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># neutron agent-list</span></span><br><span class="line">+--------------------------------------+--------------------+------------------+-------+----------------+</span><br><span class="line">| id                                   | agent_type         | host             | alive | admin_state_up |</span><br><span class="line">+--------------------------------------+--------------------+------------------+-------+----------------+</span><br><span class="line">| 1544e83b-a495-4a46-b43c-b050596ecc9a | Open vSwitch agent | node-11.example.com | :-)   | True           |</span><br><span class="line">| 2117339e-039d-4eb7-b7f0-6e645c50c69d | Metadata agent     | node-9.example.com  | :-)   | True           |</span><br><span class="line">| 75a25941-0b13-4efc-aea8-ad7150d3e89e | DHCP agent         | node-9.example.com  | :-)   | True           |</span><br><span class="line">| c8701380-1705-436f-858d-2b79a17dcff8 | L3 agent           | node-9.example.com  | :-)   | True           |</span><br><span class="line">| fa010ebe-db3b-4251-9c89-59c864d54971 | Open vSwitch agent | node-9.example.com  | :-)   | True           |</span><br><span class="line">+--------------------------------------+--------------------+------------------+-------+----------------+</span><br></pre></td></tr></table></figure>
<p># 为net_admin网络添加DHCP代理，以便此网段能够自动分配IP地址</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># neutron dhcp-agent-network-add 75a25941-0b13-4efc-aea8-ad7150d3e89e net_admin</span></span><br><span class="line">Added network net_admin to DHCP agent</span><br></pre></td></tr></table></figure>
<p># 完成后网络拓扑如图所示(net_admin和net04都是是通过router04与net04_ext相连的，Openstack控制界面上显示异常)：</p>
<p><img src="/images/14-09-10/openstack_tuopu.png" alt="Openstack网络拓扑"></p>
<h2 id="添加租户并设置网络"><a href="#添加租户并设置网络" class="headerlink" title="添加租户并设置网络"></a>添加租户并设置网络</h2><p>添加租户op.example.com，并为租户添加网络：</p>
<p># 使认证信息生效</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># . creds-admin</span></span><br></pre></td></tr></table></figure>
<p># 创建op.example.com租户，租户ID为：2e8def45720343fb9d648bd561a99c06</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># keystone tenant-create --name op.example.com</span></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">|   Property  |              Value               |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description |                                  |</span><br><span class="line">|   enabled   |               True               |</span><br><span class="line">|      id     | 2e8def45720343fb9d648bd561a99c06 |</span><br><span class="line">|     name    |          op.example.com          |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<p># 为租户创建用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># keystone user-create --name=dongliang --pass=123456 --tenant-id=2e8def45720343fb9d648bd561a99c06 --email=dongliang@example.com</span></span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">| Property |              Value               |</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">|  email   |      dongliang@example.com       |</span><br><span class="line">| enabled  |               True               |</span><br><span class="line">|    id    | 181390a3b29d4e3fa9938aa7d65bb0b3 |</span><br><span class="line">|   name   |            dongliang             |</span><br><span class="line">| tenantId | 2e8def45720343fb9d648bd561a99c06 |</span><br><span class="line">| username |            dongliang             |</span><br><span class="line">+----------+----------------------------------+</span><br></pre></td></tr></table></figure>
<p># 列出角色信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># keystone role-list</span></span><br><span class="line">+----------------------------------+-----------------+</span><br><span class="line">|                id                |       name      |</span><br><span class="line">+----------------------------------+-----------------+</span><br><span class="line">| d6284307ed704c9da4ab426f123e3c9f |      Member     |</span><br><span class="line">| 9fe2ff9ee4384b1894a90878d3e92bab |     _member_    |</span><br><span class="line">| f44b81985a3849f1ae98e36357cdad0d |      admin      |</span><br><span class="line">| e45948cda56f4306b17cb408c7d33b9b | heat_stack_user |</span><br><span class="line">+----------------------------------+-----------------+</span><br></pre></td></tr></table></figure>
<p># 为dongliang用户添加角色</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># keystone user-role-add --tenant-id 2e8def45720343fb9d648bd561a99c06 --user-id 181390a3b29d4e3fa9938aa7d65bb0b3 --role-id d6284307ed704c9da4ab426f123e3c9f</span></span><br></pre></td></tr></table></figure>
<p># 为op.example.com 租户添加网络 net_op_leju_com，具体参见为admin租户新增网段</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># neutron net-create --tenant-id 2e8def45720343fb9d648bd561a99c06 net_op_leju_com</span></span><br><span class="line">Created a new network:</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| Field                     | Value                                |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| admin_state_up            | True                                 |</span><br><span class="line">| id                        | 429f5040-ca24-42ff-9260-a5148ff47391 |</span><br><span class="line">| name                      | net_op_leju_com                      |</span><br><span class="line">| provider:network_type     | vlan                                 |</span><br><span class="line">| provider:physical_network | physnet2                             |</span><br><span class="line">| provider:segmentation_id  | 512                                  |</span><br><span class="line">| shared                    | False                                |</span><br><span class="line">| status                    | ACTIVE                               |</span><br><span class="line">| subnets                   |                                      |</span><br><span class="line">| tenant_id                 | 2e8def45720343fb9d648bd561a99c06     |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line"></span><br><span class="line">[root@node-9 ~]<span class="comment"># neutron subnet-create --tenant-id 2e8def45720343fb9d648bd561a99c06 net_op_leju_com 172.16.102.0/24</span></span><br><span class="line">Created a new subnet:</span><br><span class="line">+------------------+----------------------------------------------------+</span><br><span class="line">| Field            | Value                                              |</span><br><span class="line">+------------------+----------------------------------------------------+</span><br><span class="line">| allocation_pools | &#123;<span class="string">"start"</span>: <span class="string">"172.16.102.2"</span>, <span class="string">"end"</span>: <span class="string">"172.16.102.254"</span>&#125; |</span><br><span class="line">| cidr             | 172.16.102.0/24                                    |</span><br><span class="line">| dns_nameservers  |                                                    |</span><br><span class="line">| enable_dhcp      | True                                               |</span><br><span class="line">| gateway_ip       | 172.16.102.1                                       |</span><br><span class="line">| host_routes      |                                                    |</span><br><span class="line">| id               | e13718ef-58a0-4741-9fed-963f393202c1               |</span><br><span class="line">| ip_version       | 4                                                  |</span><br><span class="line">| name             |                                                    |</span><br><span class="line">| network_id       | 429f5040-ca24-42ff-9260-a5148ff47391               |</span><br><span class="line">| tenant_id        | 2e8def45720343fb9d648bd561a99c06                   |</span><br><span class="line">+------------------+----------------------------------------------------+</span><br></pre></td></tr></table></figure>
<p># 修改子网dns地址</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># neutron subnet-update e13718ef-58a0-4741-9fed-963f393202c1 --dns_nameservers list=true 8.8.4.4 8.8.8.8</span></span><br><span class="line">Updated subnet: e13718ef-58a0-4741-9fed-963f393202c1</span><br><span class="line"></span><br><span class="line">[root@node-9 ~]<span class="comment"># neutron router-list</span></span><br><span class="line">+--------------------------------------+----------+-----------------------------------------------------------------------------+</span><br><span class="line">| id                                   | name     | external_gateway_info                                                       |</span><br><span class="line">+--------------------------------------+----------+-----------------------------------------------------------------------------+</span><br><span class="line">| dfcf3d90-2409-4505-a020-58b8ed3c9e67 | router04 | &#123;<span class="string">"network_id"</span>: <span class="string">"c4448c0d-f633-449a-861a-a39a304cad21"</span>, <span class="string">"enable_snat"</span>: <span class="literal">true</span>&#125; |</span><br><span class="line">+--------------------------------------+----------+-----------------------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">[root@node-9 ~]<span class="comment"># neutron router-interface-add dfcf3d90-2409-4505-a020-58b8ed3c9e67 e13718ef-58a0-4741-9fed-963f393202c1</span></span><br><span class="line">Added interface 4d978e71-1b97-46d3-9f6a-7ace3aa54b3d to router dfcf3d90-2409-4505-a020-58b8ed3c9e67.</span><br><span class="line"></span><br><span class="line">[root@node-9 ~]<span class="comment"># neutron agent-list</span></span><br><span class="line">+--------------------------------------+--------------------+------------------+-------+----------------+</span><br><span class="line">| id                                   | agent_type         | host             | alive | admin_state_up |</span><br><span class="line">+--------------------------------------+--------------------+------------------+-------+----------------+</span><br><span class="line">| 1544e83b-a495-4a46-b43c-b050596ecc9a | Open vSwitch agent | node-11.example.com | :-)   | True           |</span><br><span class="line">| 2117339e-039d-4eb7-b7f0-6e645c50c69d | Metadata agent     | node-9.example.com  | :-)   | True           |</span><br><span class="line">| 75a25941-0b13-4efc-aea8-ad7150d3e89e | DHCP agent         | node-9.example.com  | :-)   | True           |</span><br><span class="line">| c8701380-1705-436f-858d-2b79a17dcff8 | L3 agent           | node-9.example.com  | :-)   | True           |</span><br><span class="line">| fa010ebe-db3b-4251-9c89-59c864d54971 | Open vSwitch agent | node-9.example.com  | :-)   | True           |</span><br><span class="line">+--------------------------------------+--------------------+------------------+-------+----------------+</span><br><span class="line"></span><br><span class="line">[root@node-9 ~]<span class="comment"># neutron dhcp-agent-network-add 75a25941-0b13-4efc-aea8-ad7150d3e89e net_op_leju_com</span></span><br><span class="line">Added network net_op_leju_com to DHCP agent</span><br><span class="line"></span><br><span class="line">[root@node-9 ~]<span class="comment"># neutron net-list</span></span><br><span class="line">+--------------------------------------+-----------------+-------------------------------------------------------+</span><br><span class="line">| id                                   | name            | subnets                                               |</span><br><span class="line">+--------------------------------------+-----------------+-------------------------------------------------------+</span><br><span class="line">| 284d3f00-042b-41b2-bec4-f5bc7dcee037 | net_admin       | 31896641-28e4-4983-b24d-f37348286a85 192.168.101.0/24 |</span><br><span class="line">| 35030315-0abb-4321-bd2d-fa02ecebe4a4 | net04           | 33fec45a-5a55-4e66-b5d0-d243a63b5b52 192.168.100.0/24 |</span><br><span class="line">| 429f5040-ca24-42ff-9260-a5148ff47391 | net_op_leju_com | e13718ef-58a0-4741-9fed-963f393202c1 172.16.102.0/24  |</span><br><span class="line">| c4448c0d-f633-449a-861a-a39a304cad21 | net04_ext       | fc9caac9-d9a9-43f4-9fec-feebc14038cd 172.16.200.0/24  |</span><br><span class="line">+--------------------------------------+-----------------+-------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">[root@node-9 ~]<span class="comment"># neutron net-show c4448c0d-f633-449a-861a-a39a304cad21</span></span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| Field                     | Value                                |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| admin_state_up            | True                                 |</span><br><span class="line">| id                        | c4448c0d-f633-449a-861a-a39a304cad21 |</span><br><span class="line">| name                      | net04_ext                            |</span><br><span class="line">| provider:network_type     | flat                                 |</span><br><span class="line">| provider:physical_network | physnet1                             |</span><br><span class="line">| provider:segmentation_id  |                                      |</span><br><span class="line">| router:external           | True                                 |</span><br><span class="line">| shared                    | *False*                              |</span><br><span class="line">| status                    | ACTIVE                               |</span><br><span class="line">| subnets                   | fc9caac9-d9a9-43f4-9fec-feebc14038cd |</span><br><span class="line">| tenant_id                 | f51b22163f504dd6a6014f4700e9ee48     |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>
<p># 修改net04_ext网络为共享模式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># neutron net-update c4448c0d-f633-449a-861a-a39a304cad21 --shared</span></span><br><span class="line">Updated network: c4448c0d-f633-449a-861a-a39a304cad21</span><br><span class="line"></span><br><span class="line">[root@node-9 ~]<span class="comment"># neutron net-show c4448c0d-f633-449a-861a-a39a304cad21</span></span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| Field                     | Value                                |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| admin_state_up            | True                                 |</span><br><span class="line">| id                        | c4448c0d-f633-449a-861a-a39a304cad21 |</span><br><span class="line">| name                      | net04_ext                            |</span><br><span class="line">| provider:network_type     | flat                                 |</span><br><span class="line">| provider:physical_network | physnet1                             |</span><br><span class="line">| provider:segmentation_id  |                                      |</span><br><span class="line">| router:external           | True                                 |</span><br><span class="line">| shared                    | *True*                               |</span><br><span class="line">| status                    | ACTIVE                               |</span><br><span class="line">| subnets                   | fc9caac9-d9a9-43f4-9fec-feebc14038cd |</span><br><span class="line">| tenant_id                 | f51b22163f504dd6a6014f4700e9ee48     |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>
<p># 完成后网络拓扑如图所示(net_op_leju_com是通过router04与net04_ext相连的，Openstack控制界面上显示异常)：</p>
<blockquote>
<p>注意： 以上租户和网络创建都是通过命令行添加的，Openstack界面也可以实现部分功能，但有时添加会有问题，建议使用命令行添加。</p>
</blockquote>
<p># 如需要修改网络端口IP，可以如下修改：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@node-15:~<span class="comment"># neutron port-list</span></span><br><span class="line">+--------------------------------------+------+-------------------+--------------------------------------------------------------------------------------+</span><br><span class="line">| id                                   | name | mac_address       | fixed_ips                                                                            |</span><br><span class="line">+--------------------------------------+------+-------------------+--------------------------------------------------------------------------------------+</span><br><span class="line">| 03ecb6fc-a695-4151-aef8-87a64c863be3 |      | fa:16:3e:0c:e0:60 | &#123;<span class="string">"subnet_id"</span>: <span class="string">"2f286f76-3532-41ab-81d8-6273ed5a3c6a"</span>, <span class="string">"ip_address"</span>: <span class="string">"172.16.0.132"</span>&#125;  |</span><br><span class="line">| 194d33d5-5184-41cb-9a30-09e580bc4d3f |      | fa:16:3e:1a:20:66 | &#123;<span class="string">"subnet_id"</span>: <span class="string">"5dd3709e-3171-40a5-891c-bc2d73c0a9a0"</span>, <span class="string">"ip_address"</span>: <span class="string">"192.168.111.3"</span>&#125; |</span><br><span class="line">| 29c50618-af2d-401b-bfe3-3ef38d2292c4 |      | fa:16:3e:71:c4:d0 | &#123;<span class="string">"subnet_id"</span>: <span class="string">"2f286f76-3532-41ab-81d8-6273ed5a3c6a"</span>, <span class="string">"ip_address"</span>: <span class="string">"172.16.0.137"</span>&#125;  |</span><br><span class="line">| 2bf7f2e0-3172-4c52-bcc1-40750492bca6 |      | fa:16:3e:ec:8f:87 | &#123;<span class="string">"subnet_id"</span>: <span class="string">"2f286f76-3532-41ab-81d8-6273ed5a3c6a"</span>, <span class="string">"ip_address"</span>: <span class="string">"172.16.0.136"</span>&#125;  |</span><br><span class="line">| 3299792b-07b3-48a0-9213-506034c05744 |      | fa:16:3e:88:ae:10 | &#123;<span class="string">"subnet_id"</span>: <span class="string">"2f286f76-3532-41ab-81d8-6273ed5a3c6a"</span>, <span class="string">"ip_address"</span>: <span class="string">"172.16.0.133"</span>&#125;  |</span><br><span class="line">| 421171b2-1abc-4423-8a46-c9ffa1ad11a0 |      | fa:16:3e:f0:d7:93 | &#123;<span class="string">"subnet_id"</span>: <span class="string">"2f286f76-3532-41ab-81d8-6273ed5a3c6a"</span>, <span class="string">"ip_address"</span>: <span class="string">"172.16.0.138"</span>&#125;  |</span><br><span class="line">| 421682b0-d76c-4d64-8cf7-a62c40733109 |      | fa:16:3e:fa:30:e4 | &#123;<span class="string">"subnet_id"</span>: <span class="string">"956d685c-e7b3-420c-a127-3eedda941e4b"</span>, <span class="string">"ip_address"</span>: <span class="string">"192.168.112.2"</span>&#125; |</span><br><span class="line">| 55b5a275-7db8-4a31-8c84-089af254d3e1 |      | fa:16:3e:28:<span class="built_in">cd</span>:fd | &#123;<span class="string">"subnet_id"</span>: <span class="string">"2f286f76-3532-41ab-81d8-6273ed5a3c6a"</span>, <span class="string">"ip_address"</span>: <span class="string">"172.16.0.135"</span>&#125;  |</span><br><span class="line">| 6948a94a-b90d-4cbd-b8e5-a25ea78fc407 |      | fa:16:3e:17:1f:98 | &#123;<span class="string">"subnet_id"</span>: <span class="string">"2f286f76-3532-41ab-81d8-6273ed5a3c6a"</span>, <span class="string">"ip_address"</span>: <span class="string">"172.16.0.131"</span>&#125;  |</span><br><span class="line">| 70ef22b5-dd3a-4efe-9335-3c67a096fa22 |      | fa:16:3e:78:43:60 | &#123;<span class="string">"subnet_id"</span>: <span class="string">"2f286f76-3532-41ab-81d8-6273ed5a3c6a"</span>, <span class="string">"ip_address"</span>: <span class="string">"172.16.0.140"</span>&#125;  |</span><br><span class="line">| 7c1286e7-e606-46f5-976e-508de1872c8b |      | fa:16:3e:01:20:c4 | &#123;<span class="string">"subnet_id"</span>: <span class="string">"2f286f76-3532-41ab-81d8-6273ed5a3c6a"</span>, <span class="string">"ip_address"</span>: <span class="string">"172.16.0.134"</span>&#125;  |</span><br><span class="line">| 80bb3f49-8cf5-4841-afe1-fa60379bfeef |      | fa:16:3e:a5:14:61 | &#123;<span class="string">"subnet_id"</span>: <span class="string">"5dd3709e-3171-40a5-891c-bc2d73c0a9a0"</span>, <span class="string">"ip_address"</span>: <span class="string">"192.168.111.1"</span>&#125; |</span><br><span class="line">| 99b119c9-5062-48e9-a0f4-55b36c70596f |      | fa:16:3e:<span class="built_in">fc</span>:8e:c9 | &#123;<span class="string">"subnet_id"</span>: <span class="string">"956d685c-e7b3-420c-a127-3eedda941e4b"</span>, <span class="string">"ip_address"</span>: <span class="string">"192.168.112.3"</span>&#125; |</span><br><span class="line">| a7863873-60b7-4372-9cd5-3a8a934a5ace |      | fa:16:3e:2f:23:69 | &#123;<span class="string">"subnet_id"</span>: <span class="string">"2f286f76-3532-41ab-81d8-6273ed5a3c6a"</span>, <span class="string">"ip_address"</span>: <span class="string">"172.16.0.139"</span>&#125;  |</span><br><span class="line">| bc753c4c-ad8b-4a62-aebf-4432e2376db4 |      | fa:16:3e:76:da:b7 | &#123;<span class="string">"subnet_id"</span>: <span class="string">"5dd3709e-3171-40a5-891c-bc2d73c0a9a0"</span>, <span class="string">"ip_address"</span>: <span class="string">"192.168.111.2"</span>&#125; |</span><br><span class="line">| de4bb0a0-24ad-4aa6-9263-665bc9ff633b |      | fa:16:3e:75:c5:00 | &#123;<span class="string">"subnet_id"</span>: <span class="string">"2f286f76-3532-41ab-81d8-6273ed5a3c6a"</span>, <span class="string">"ip_address"</span>: <span class="string">"172.16.0.130"</span>&#125;  |</span><br><span class="line">+--------------------------------------+------+-------------------+--------------------------------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">root@node-15:~<span class="comment"># neutron port-update 421682b0-d76c-4d64-8cf7-a62c40733109 -- --fixed_ips type=dict list=true ip_address=192.168.112.1</span></span><br><span class="line">Updated port: 421682b0-d76c-4d64-8cf7-a62c40733109</span><br></pre></td></tr></table></figure>
<h2 id="在Openstack上启动CoreOS集群"><a href="#在Openstack上启动CoreOS集群" class="headerlink" title="在Openstack上启动CoreOS集群"></a>在Openstack上启动CoreOS集群</h2><p># 设置认证权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># cat creds-admin</span></span><br><span class="line"><span class="built_in">export</span> OS_TENANT_NAME=admin</span><br><span class="line"><span class="built_in">export</span> OS_USERNAME=admin</span><br><span class="line"><span class="built_in">export</span> OS_PASSWORD=admin</span><br><span class="line"><span class="built_in">export</span> OS_AUTH_URL=<span class="string">"http://172.16.200.2:5000/v2.0/“</span></span><br></pre></td></tr></table></figure>
<p># 使认证权限生效</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># . creds-admin</span></span><br></pre></td></tr></table></figure>
<p># 下载CoreOS镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># wget http://alpha.release.core-os.net/amd64-usr/current/coreos_production_openstack_image.img.bz2</span></span><br></pre></td></tr></table></figure>
<p># 解压CoreOS镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># bunzip2 coreos_production_openstack_image.img.bz2</span></span><br></pre></td></tr></table></figure>
<p># 通过glance将镜像导入Openstack中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># glance image-create --name "CoreOS Stable 410.0.0" \</span></span><br><span class="line">--container-format bare \</span><br><span class="line">--disk-format qcow2 \</span><br><span class="line">--file coreos_production_openstack_image.img \</span><br><span class="line">--is-public True</span><br><span class="line">+------------------+--------------------------------------+</span><br><span class="line">| Property         | Value                                |</span><br><span class="line">+------------------+--------------------------------------+</span><br><span class="line">| checksum         | 2dc4d85f15f1de1c945cd2363418512b     |</span><br><span class="line">| container_format | bare                                 |</span><br><span class="line">| created_at       | 2014-09-03T05:08:26                  |</span><br><span class="line">| deleted          | False                                |</span><br><span class="line">| deleted_at       | None                                 |</span><br><span class="line">| disk_format      | qcow2                                |</span><br><span class="line">| id               | c3c0b86d-b2a6-4129-9bbd-b27fa4f88e06 |</span><br><span class="line">| is_public        | True                                 |</span><br><span class="line">| min_disk         | 0                                    |</span><br><span class="line">| min_ram          | 0                                    |</span><br><span class="line">| name             | CoreOS Stable 410.0.0                |</span><br><span class="line">| owner            | f51b22163f504dd6a6014f4700e9ee48     |</span><br><span class="line">| protected        | False                                |</span><br><span class="line">| size             | 448790528                            |</span><br><span class="line">| status           | active                               |</span><br><span class="line">| updated_at       | 2014-09-03T05:08:41                  |</span><br><span class="line">| virtual_size     | None                                 |</span><br><span class="line">+------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>
<p># 获取etcd token</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># curl https://discovery.etcd.io/new</span></span><br><span class="line">https://discovery.etcd.io/c964af3ff154db796db834fedae038d4</span><br></pre></td></tr></table></figure>
<p># 修改cloud-config.yaml文件，填入获取的token和要登录机器的ssh key</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># cat cloud-config.yaml</span></span><br><span class="line"><span class="comment">#cloud-config</span></span><br><span class="line">coreos:</span><br><span class="line">  etcd:</span><br><span class="line">    <span class="comment"># generate a new token for each unique cluster from https://discovery.etcd.io/new</span></span><br><span class="line">    discovery: https://discovery.etcd.io/c964af3ff154db796db834fedae038d4</span><br><span class="line">    <span class="comment"># multi-region and multi-cloud deployments need to use $public_ipv4</span></span><br><span class="line">    addr: <span class="variable">$private_ipv4</span>:4001</span><br><span class="line">    peer-addr: <span class="variable">$private_ipv4</span>:7001</span><br><span class="line">  units:</span><br><span class="line">    - name: etcd.service</span><br><span class="line">      <span class="built_in">command</span>: start</span><br><span class="line">    - name: fleet.service</span><br><span class="line">      <span class="built_in">command</span>: start</span><br><span class="line">ssh_authorized_keys:</span><br><span class="line">  <span class="comment"># include one or more SSH public keys</span></span><br><span class="line">  - ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA2DwT6v5NUUBNBOjC4Z9ZCLLQW0efG+0gpLP5Axi9uslrfCIpVt4MwMktXFegI4eulqATlA+la7pw65MYF8Gm0H9binmqJkDyPilhQkgHltrHOibRww3SddBrQtPddzcD3UPMAWyOiq/3LUhHutMguoKvp2KFoMoakofy6LBsD2xrSnavqycVqw2yb9RDg3c4VVECnVpgDiPPxo8woBWL3PooWZDxEnTqNhm37NXrpRw0xOqLy0x44/1fucwBWpzTXLD2fGLz4JAcgJ8oZHv8hhgadMYMqRRrlYpq0Sx2HiTY/0Co3AzyzQ8kRK0gVLIm3eLE3yzEVEVsa2Bm7LUq4w== root@fuel.example.com</span><br></pre></td></tr></table></figure>
<p># 以上user-data会通过Openstack Metadata服务注入虚拟机，在虚拟机里访问Metadata接口可以看到注入的用户数据：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># curl http://169.254.169.254/openstack/2012-08-10/user_data</span></span><br><span class="line"><span class="comment">#cloud-config</span></span><br><span class="line">coreos:</span><br><span class="line">  etcd:</span><br><span class="line">    <span class="comment"># generate a new token for each unique cluster from https://discovery.etcd.io/new</span></span><br><span class="line">    discovery: https://discovery.etcd.io/c964af3ff154db796db834fedae038d4</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p># 列出网络信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># nova net-list</span></span><br><span class="line">+--------------------------------------+-----------------+------+</span><br><span class="line">| ID                                   | Label           | CIDR |</span><br><span class="line">+--------------------------------------+-----------------+------+</span><br><span class="line">| 284d3f00-042b-41b2-bec4-f5bc7dcee037 | net_admin       | -    |</span><br><span class="line">| 35030315-0abb-4321-bd2d-fa02ecebe4a4 | net04           | -    |</span><br><span class="line">| 429f5040-ca24-42ff-9260-a5148ff47391 | net_op_leju_com | -    |</span><br><span class="line">| c4448c0d-f633-449a-861a-a39a304cad21 | net04_ext       | -    |</span><br><span class="line">+--------------------------------------+-----------------+------+</span><br></pre></td></tr></table></figure>
<p># 列出虚拟机规格信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># nova flavor-list</span></span><br><span class="line">+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+</span><br><span class="line">| ID | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |</span><br><span class="line">+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+</span><br><span class="line">| 1  | m1.tiny   | 512       | 1    | 0         |      | 1     | 1.0         | True      |</span><br><span class="line">| 2  | m1.small  | 2048      | 20   | 0         |      | 1     | 1.0         | True      |</span><br><span class="line">| 3  | m1.medium | 4096      | 40   | 0         |      | 2     | 1.0         | True      |</span><br><span class="line">| 4  | m1.large  | 8192      | 80   | 0         |      | 4     | 1.0         | True      |</span><br><span class="line">| 5  | m1.xlarge | 16384     | 160  | 0         |      | 8     | 1.0         | True      |</span><br><span class="line">+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+</span><br></pre></td></tr></table></figure>
<p># 通过nova boot命令启动三个CoreOS虚拟机实例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># nova boot \  </span></span><br><span class="line">--user-data ./cloud-config.yaml \  </span><br><span class="line">--image c3c0b86d-b2a6-4129-9bbd-b27fa4f88e06 \  </span><br><span class="line">--key-name fuel \  </span><br><span class="line">--flavor m1.small \  </span><br><span class="line">--num-instances 3 \  </span><br><span class="line">--nic net-id=284d3f00-042b-41b2-bec4-f5bc7dcee037 \  </span><br><span class="line">--security-groups default coreos</span><br><span class="line">+--------------------------------------+--------------------------------------------------------------+</span><br><span class="line">| Property                             | Value                                                        |</span><br><span class="line">+--------------------------------------+--------------------------------------------------------------+</span><br><span class="line">| OS-DCF:diskConfig                    | MANUAL                                                       |</span><br><span class="line">| OS-EXT-AZ:availability_zone          | nova                                                         |</span><br><span class="line">| OS-EXT-SRV-ATTR:host                 | -                                                            |</span><br><span class="line">| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                            |</span><br><span class="line">| OS-EXT-SRV-ATTR:instance_name        | instance-00000031                                            |</span><br><span class="line">| OS-EXT-STS:power_state               | 0                                                            |</span><br><span class="line">| OS-EXT-STS:task_state                | scheduling                                                   |</span><br><span class="line">| OS-EXT-STS:vm_state                  | building                                                     |</span><br><span class="line">| OS-SRV-USG:launched_at               | -                                                            |</span><br><span class="line">| OS-SRV-USG:terminated_at             | -                                                            |</span><br><span class="line">| accessIPv4                           |                                                              |</span><br><span class="line">| accessIPv6                           |                                                              |</span><br><span class="line">| adminPass                            | UWDaX8vxvzZn                                                 |</span><br><span class="line">| config_drive                         |                                                              |</span><br><span class="line">| created                              | 2014-09-03T06:14:10Z                                         |</span><br><span class="line">| flavor                               | m1.small (2)                                                 |</span><br><span class="line">| hostId                               |                                                              |</span><br><span class="line">| id                                   | a51d1492-9352-4979-8049-6e089af4fa65                         |</span><br><span class="line">| image                                | CoreOS Stable 410.0.0 (c3c0b86d-b2a6-4129-9bbd-b27fa4f88e06) |</span><br><span class="line">| key_name                             | fuel                                                         |</span><br><span class="line">| metadata                             | &#123;&#125;                                                           |</span><br><span class="line">| name                                 | coreos-a51d1492-9352-4979-8049-6e089af4fa65                  |</span><br><span class="line">| os-extended-volumes:volumes_attached | []                                                           |</span><br><span class="line">| progress                             | 0                                                            |</span><br><span class="line">| security_groups                      | default                                                      |</span><br><span class="line">| status                               | BUILD                                                        |</span><br><span class="line">| tenant_id                            | f51b22163f504dd6a6014f4700e9ee48                             |</span><br><span class="line">| updated                              | 2014-09-03T06:14:10Z                                         |</span><br><span class="line">| user_id                              | 8ad92b9cf95c4468b7718bbce22a39e0                             |</span><br><span class="line">+--------------------------------------+--------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<p># 列出浮动IP地址</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># nova floating-ip-list</span></span><br><span class="line">+----------------+-----------+----------------+-----------+</span><br><span class="line">| Ip             | Server Id | Fixed Ip       | Pool      |</span><br><span class="line">+----------------+-----------+----------------+-----------+</span><br><span class="line">| 172.16.200.138 |           | -              | net04_ext |</span><br><span class="line">| 172.16.200.134 |           | -              | net04_ext |</span><br><span class="line">| 172.16.200.137 |           | -              | net04_ext |</span><br><span class="line">| 172.16.200.135 |           | -              | net04_ext |</span><br><span class="line">| 172.16.200.131 |           | -              | net04_ext |</span><br><span class="line">| 172.16.200.132 |           | -              | net04_ext |</span><br><span class="line">| 172.16.200.136 |           | -              | net04_ext |</span><br><span class="line">| 172.16.200.139 |           | -              | net04_ext |</span><br><span class="line">| 172.16.200.133 |           | -              | net04_ext |</span><br><span class="line">| 172.16.200.140 |           | -              | net04_ext |</span><br><span class="line">+----------------+-----------+----------------+-----------+</span><br></pre></td></tr></table></figure>
<p># 列出虚拟机</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># nova list</span></span><br><span class="line">+--------------------------------------+---------------------------------------------+--------+------------+-------------+------------------------------------------+</span><br><span class="line">| ID                                   | Name                                        | Status | Task State | Power State | Networks                                 |</span><br><span class="line">+--------------------------------------+---------------------------------------------+--------+------------+-------------+------------------------------------------+</span><br><span class="line">| 3198baad-9a01-469f-af5b-13665b01c7f0 | coreos-3198baad-9a01-469f-af5b-13665b01c7f0 | ACTIVE | -          | Running     | net_admin=192.168.101.22                 |</span><br><span class="line">| 71a03186-1327-4608-bd66-b59f6c49c85c | coreos-71a03186-1327-4608-bd66-b59f6c49c85c | ACTIVE | -          | Running     | net_admin=192.168.101.23                 |</span><br><span class="line">| a51d1492-9352-4979-8049-6e089af4fa65 | coreos-a51d1492-9352-4979-8049-6e089af4fa65 | ACTIVE | -          | Running     | net_admin=192.168.101.21                 |</span><br><span class="line">| e2a5901b-cfd7-41d7-bd7f-f8e4e18cfc0f | vm_centos_7                                 | ACTIVE | -          | Running     | net04=192.168.100.12, 172.16.200.134     |</span><br><span class="line">+--------------------------------------+---------------------------------------------+--------+------------+-------------+------------------------------------------+</span><br></pre></td></tr></table></figure>
<p># 为虚拟机绑定浮动IP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># nova add-floating-ip coreos-a51d1492-9352-4979-8049-6e089af4fa65 172.16.200.131</span></span><br><span class="line">[root@node-9 ~]<span class="comment"># nova add-floating-ip coreos-3198baad-9a01-469f-af5b-13665b01c7f0 172.16.200.132</span></span><br><span class="line">[root@node-9 ~]<span class="comment"># nova add-floating-ip coreos-71a03186-1327-4608-bd66-b59f6c49c85c 172.16.200.133</span></span><br></pre></td></tr></table></figure>
<p># 界面中查看虚拟机情况</p>
<p><img src="/images/14-09-10/openstack_coreos.png" alt="Openstack CoreOS"></p>
<p># 通过浮动IP登录CoreOS虚拟机</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@fuel ~]<span class="comment"># ssh core@172.16.200.131</span></span><br><span class="line">CoreOS (stable)</span><br><span class="line">core@coreos-a51d1492-9352-4979-8049-6e089af4fa65 ~ $ sudo su -</span><br><span class="line">coreos-a51d1492-9352-4979-8049-6e089af4fa65 ~ <span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h2 id="强制删除非正常状态的卷"><a href="#强制删除非正常状态的卷" class="headerlink" title="强制删除非正常状态的卷"></a>强制删除非正常状态的卷</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># . creds-admin</span></span><br><span class="line">[root@node-9 ~]<span class="comment"># cinder list</span></span><br><span class="line">+--------------------------------------+----------+----------------------------+------+-------------+----------+--------------------------------------+</span><br><span class="line">|                  ID                  |  Status  |        Display Name        | Size | Volume Type | Bootable |             Attached to              |</span><br><span class="line">+--------------------------------------+----------+----------------------------+------+-------------+----------+--------------------------------------+</span><br><span class="line">| 2f1219c1-9081-4a1e-ac4f-3b9e77b71bbb | creating | ost1_test-volume1530754005 |  1   |     None    |  <span class="literal">false</span>   |                                      |</span><br><span class="line">| 524bb475-d63f-4479-9a94-4d7eef87cf9a | creating |        domino_data         |  3   |     None    |  <span class="literal">false</span>   |                                      |</span><br><span class="line">| 937fedef-f9c0-4d8c-aca8-fc1aa6de27ab | creating |          vd_test           |  10  |     None    |  <span class="literal">false</span>   |                                      |</span><br><span class="line">| fcfc1fb1-5884-4ed9-a0f7-dd084c953ce4 |  <span class="keyword">in</span>-use  |       vd_domino_test       |  3   |     None    |   <span class="literal">true</span>   | b46e1c74-f442-41ae-b480-fdd4d376dca5 |</span><br><span class="line">+--------------------------------------+----------+----------------------------+------+-------------+----------+--------------------------------------+</span><br><span class="line"></span><br><span class="line">[root@node-9 ~]<span class="comment"># cinder reset-state --state available 937fedef-f9c0-4d8c-aca8-fc1aa6de27ab</span></span><br><span class="line">[root@node-9 ~]<span class="comment"># cinder delete 937fedef-f9c0-4d8c-aca8-fc1aa6de27ab</span></span><br><span class="line">[root@node-9 ~]<span class="comment"># cinder list</span></span><br><span class="line">+--------------------------------------+----------+----------------------------+------+-------------+----------+--------------------------------------+</span><br><span class="line">|                  ID                  |  Status  |        Display Name        | Size | Volume Type | Bootable |             Attached to              |</span><br><span class="line">+--------------------------------------+----------+----------------------------+------+-------------+----------+--------------------------------------+</span><br><span class="line">| 2f1219c1-9081-4a1e-ac4f-3b9e77b71bbb | creating | ost1_test-volume1530754005 |  1   |     None    |  <span class="literal">false</span>   |                                      |</span><br><span class="line">| 524bb475-d63f-4479-9a94-4d7eef87cf9a | creating |        domino_data         |  3   |     None    |  <span class="literal">false</span>   |                                      |</span><br><span class="line">| fcfc1fb1-5884-4ed9-a0f7-dd084c953ce4 |  <span class="keyword">in</span>-use  |       vd_domino_test       |  3   |     None    |   <span class="literal">true</span>   | b46e1c74-f442-41ae-b480-fdd4d376dca5 |</span><br><span class="line">+--------------------------------------+----------+----------------------------+------+-------------+----------+--------------------------------------+</span><br></pre></td></tr></table></figure>
<h2 id="强制删除ERROR状态的虚拟机"><a href="#强制删除ERROR状态的虚拟机" class="headerlink" title="强制删除ERROR状态的虚拟机"></a>强制删除ERROR状态的虚拟机</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@node-9 ~]<span class="comment"># nova list</span></span><br><span class="line">+--------------------------------------+--------------+--------+------------+-------------+----------------------------------------------+</span><br><span class="line">| ID                                   | Name         | Status | Task State | Power State | Networks                                     |</span><br><span class="line">+--------------------------------------+--------------+--------+------------+-------------+----------------------------------------------+</span><br><span class="line">| c915770b-b2d3-4196-bb68-fc19aa2a6da9 | vm_cirros_op | ERROR  | deleting   | Shutdown    | net_op_leju_com=172.16.102.4, 172.16.200.142 |</span><br><span class="line">+--------------------------------------+--------------+--------+------------+-------------+----------------------------------------------+</span><br><span class="line"></span><br><span class="line">[root@node-9 ~]<span class="comment"># nova reset-state --active c915770b-b2d3-4196-bb68-fc19aa2a6da9</span></span><br><span class="line">[root@node-9 ~]<span class="comment"># nova show c915770b-b2d3-4196-bb68-fc19aa2a6da9</span></span><br><span class="line">+--------------------------------------+----------------------------------------------------------+</span><br><span class="line">| Property                             | Value                                                    |</span><br><span class="line">+--------------------------------------+----------------------------------------------------------+</span><br><span class="line">| OS-DCF:diskConfig                    | AUTO                                                     |</span><br><span class="line">| OS-EXT-AZ:availability_zone          | nova                                                     |</span><br><span class="line">| OS-EXT-SRV-ATTR:host                 | node-11.example.com                                         |</span><br><span class="line">| OS-EXT-SRV-ATTR:hypervisor_hostname  | node-11.example.com                                         |</span><br><span class="line">| OS-EXT-SRV-ATTR:instance_name        | instance-00000014                                        |</span><br><span class="line">| OS-EXT-STS:power_state               | 4                                                        |</span><br><span class="line">| OS-EXT-STS:task_state                | -                                                        |</span><br><span class="line">| OS-EXT-STS:vm_state                  | active                                                   |</span><br><span class="line">| OS-SRV-USG:launched_at               | 2014-09-02T07:46:46.000000                               |</span><br><span class="line">| OS-SRV-USG:terminated_at             | -                                                        |</span><br><span class="line">| accessIPv4                           |                                                          |</span><br><span class="line">| accessIPv6                           |                                                          |</span><br><span class="line">| config_drive                         |                                                          |</span><br><span class="line">| created                              | 2014-09-02T07:46:38Z                                     |</span><br><span class="line">| flavor                               | m1.tiny (1)                                              |</span><br><span class="line">| hostId                               | b51d791c8cc535dc723deed170df51ca5c415932f01b2c6b3fb67508 |</span><br><span class="line">| id                                   | c915770b-b2d3-4196-bb68-fc19aa2a6da9                     |</span><br><span class="line">| image                                | TestVM (722f1732-8a7a-4024-bd99-e039c2681360)            |</span><br><span class="line">| key_name                             | fuel                                                     |</span><br><span class="line">| metadata                             | &#123;&#125;                                                       |</span><br><span class="line">| name                                 | vm_cirros_op                                             |</span><br><span class="line">| net_op_leju_com network              | 172.16.102.4, 172.16.200.142                             |</span><br><span class="line">| os-extended-volumes:volumes_attached | []                                                       |</span><br><span class="line">| progress                             | 0                                                        |</span><br><span class="line">| status                               | ACTIVE                                                   |</span><br><span class="line">| tenant_id                            | 2e8def45720343fb9d648bd561a99c06                         |</span><br><span class="line">| updated                              | 2014-09-12T03:39:08Z                                     |</span><br><span class="line">| user_id                              | 181390a3b29d4e3fa9938aa7d65bb0b3                         |</span><br><span class="line">+--------------------------------------+----------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">[root@node-9 ~]<span class="comment"># nova delete c915770b-b2d3-4196-bb68-fc19aa2a6da9</span></span><br><span class="line">[root@node-9 ~]<span class="comment"># nova list</span></span><br><span class="line">+----+------+--------+------------+-------------+----------+</span><br><span class="line">| ID | Name | Status | Task State | Power State | Networks |</span><br><span class="line">+----+------+--------+------------+-------------+----------+</span><br><span class="line">+----+------+--------+------------+-------------+----------+</span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/虚拟化/">虚拟化</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Openstack/">Openstack</a><a href="/tags/KVM/">KVM</a><a href="/tags/Ceph/">Ceph</a><a href="/tags/CoreOS/">CoreOS</a>
    </span>
    

    </div>

    
  </div>
</article>

  

	<section id="comment" class="comment">
		<div id="gitment"></div>
	</section>
	<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
	<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
	<script>
		var gitment = new Gitment({
			owner: 'ist0ne',
			repo: 'https://github.com/ist0ne/gitment.git',
			oauth: {
				client_id: 'a3a5af94aef00fdf0c24',
				client_secret: '3d47316b6b7d0b98ba405da19a65457357256f2d',
			},
		})
		gitment.render('gitment')
	</script>





    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    <br>
    
    &copy; 2019 ist0ne
    
  </p>
</footer>
    
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-39923501-1', 'auto');
    ga('send', 'pageview');

</script>

  </div>
</div>
</body>
</html>